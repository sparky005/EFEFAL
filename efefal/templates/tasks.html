<!doctype html>
{% extends 'base.html' %}
<title>Tasks for {{ playbook }}, session {{ session }}</title>
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="text-center">{{ playbook }}</h1>
            <h2>Session Summary</h2>
            <table class="table table-hover">
                <tr>
                    <th>Host</th>
                    <th>Ok</th>
                    <th>Failures</th>
                    <th>Unreachable</th>
                    <th>Changed</th>
                    <th>Skipped</th>
                    {% for host, results in finish.items() %}
                    <tr>
                        <td><a href="{{ url_for('efefal.session_tasks', playbook=playbook, session=session, host=host) }}">{{ host }}</a></td>
                        {% for key, value in results.items() %}
                        <td><a href="{{ url_for('efefal.session_tasks', playbook=playbook, session=session, host=host, status=key) }}">{{ value }}</a></td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                    <tr>
                        <td>Total</td>
                        {% for key, value in total.items() %}
                        <td><a href="{{ url_for('efefal.session_tasks', playbook=playbook, session=session, status=key) }}">{{ value }}</a></td>
                        {% endfor %}
                    </tr>
            </table>

            <h2>Tasks</h2>
            <h4><small><em>Click on a host for more information</em></small></h4>
            <table class="table table-hover">
                {% if request.args.get('host') or request.args.get('status') %}
                <tr>
                    <th>Timestamp</th>
                    <th>Host</th>
                    <th>Task</th>
                    <th>Status</th>
                </tr>
                {% for task in tasks %}
                <tr>
                    <td>{{ task['@timestamp'] }}</td>
                    <td>{{ task['ansible_host'] }}</td>
                    <td>{{ task['ansible_task'] }}</td>
                    <td>{{ task['status'] }}</td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <th>Timestamp</th>
                    <th>Task</th>
                </tr>
                {% for task in tasks %}
                <tr>
                    <td>{{ task['@timestamp'] }}</td>
                    <td>{{ task['ansible_task'] }}</td>
                </tr>
                {% endfor %}
                {% endif %}
            </table>
        </div>
    </div>
</div>
{% endblock %}
